{% extends "base.html" %}
{% block title %}íŒŒì¼ ì—…ë¡œë“œ - ê°€ê³„ë¶€{% endblock %}

{% block content %}
<div class="upload-page">
    <header class="page-header">
        <h1>ğŸ“‚ ëª…ì„¸ì„œ ì—…ë¡œë“œ</h1>
    </header>

    <div class="card upload-card">
        <div class="upload-zone" id="uploadZone">
            <div class="upload-icon">ğŸ“„</div>
            <h3>ì¹´ë“œ ëª…ì„¸ì„œ íŒŒì¼ì„ ë“œë˜ê·¸í•˜ê±°ë‚˜ í´ë¦­í•˜ì„¸ìš”</h3>
            <p>ì§€ì› í˜•ì‹: Excel (.xlsx, .xls), CSV (.csv)</p>
            <input type="file" id="fileInput" accept=".xlsx,.xls,.csv" hidden>
        </div>

        <div id="uploadProgress" class="upload-progress" style="display: none;">
            <div class="progress-bar">
                <div class="progress-fill"></div>
            </div>
            <p class="progress-text">ì—…ë¡œë“œ ì¤‘...</p>
        </div>

        <div id="uploadResult" class="upload-result" style="display: none;"></div>
    </div>

    <div class="card info-card">
        <h3>ğŸ’¡ ì‚¬ìš© ë°©ë²•</h3>
        <ol>
            <li>ì‚¼ì„±ì¹´ë“œ í™ˆí˜ì´ì§€ì—ì„œ ëª…ì„¸ì„œë¥¼ Excel íŒŒì¼ë¡œ ë‹¤ìš´ë¡œë“œí•©ë‹ˆë‹¤.</li>
            <li>ìœ„ ì˜ì—­ì— íŒŒì¼ì„ ë“œë˜ê·¸í•˜ê±°ë‚˜ í´ë¦­í•˜ì—¬ ì—…ë¡œë“œí•©ë‹ˆë‹¤.</li>
            <li>ìë™ìœ¼ë¡œ ê±°ë˜ ë‚´ì—­ì´ ì¶”ì¶œë˜ì–´ ì €ì¥ë©ë‹ˆë‹¤.</li>
            <li>ê±°ë˜ ë‚´ì—­ í˜ì´ì§€ì—ì„œ ì¹´í…Œê³ ë¦¬ì™€ ë©”ëª¨ë¥¼ ê´€ë¦¬í•˜ì„¸ìš”.</li>
        </ol>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    const uploadZone = document.getElementById('uploadZone');
    const fileInput = document.getElementById('fileInput');
    const progress = document.getElementById('uploadProgress');
    const result = document.getElementById('uploadResult');

    uploadZone.addEventListener('click', () => fileInput.click());

    uploadZone.addEventListener('dragover', (e) => {
        e.preventDefault();
        uploadZone.classList.add('dragover');
    });

    uploadZone.addEventListener('dragleave', () => {
        uploadZone.classList.remove('dragover');
    });

    uploadZone.addEventListener('drop', (e) => {
        e.preventDefault();
        uploadZone.classList.remove('dragover');
        const file = e.dataTransfer.files[0];
        if (file) uploadFile(file);
    });

    fileInput.addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (file) uploadFile(file);
    });

    async function uploadFile(file) {
        progress.style.display = 'block';
        result.style.display = 'none';

        const formData = new FormData();
        formData.append('file', file);

        try {
            const res = await fetch('/upload', {
                method: 'POST',
                body: formData
            });

            const data = await res.json();

            progress.style.display = 'none';
            result.style.display = 'block';

            if (res.ok) {
                result.innerHTML = `
                <div class="success">
                    <span class="icon">âœ…</span>
                    <p>${data.message}</p>
                    <a href="/transactions" class="btn btn-primary">ê±°ë˜ ë‚´ì—­ ë³´ê¸°</a>
                </div>
            `;
            } else {
                result.innerHTML = `
                <div class="error">
                    <span class="icon">âŒ</span>
                    <p>ì˜¤ë¥˜: ${data.error}</p>
                </div>
            `;
            }
        } catch (err) {
            progress.style.display = 'none';
            result.style.display = 'block';
            result.innerHTML = `
            <div class="error">
                <span class="icon">âŒ</span>
                <p>ì—…ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>
            </div>
        `;
        }
    }
</script>
{% endblock %}